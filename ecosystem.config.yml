apps:
  # HTTP API Server
  - name: api
    script: ./src/server.js
    instances: 2
    exec_mode: cluster
    env:
      NODE_ENV: production
    env_development:
      NODE_ENV: development
    error_file: ./logs/pm2/api-error.log
    out_file: ./logs/pm2/api-out.log
    log_date_format: YYYY-MM-DD HH:mm:ss Z
    merge_logs: true
    max_memory_restart: 500M
    min_uptime: 10000
    max_restarts: 10
    autorestart: true
    watch: false

  # Regular Transcription Worker (high volume, â‰¤40 min meetings)
  - name: worker-transcription
    script: ./src/worker/index.js
    args: --type transcription --concurrency 5
    instances: 1
    exec_mode: fork
    env:
      NODE_ENV: production
      WORKER_CONCURRENCY: 1
    env_development:
      NODE_ENV: development
      WORKER_CONCURRENCY: 1
    error_file: ./logs/pm2/worker-transcription-error.log
    out_file: ./logs/pm2/worker-transcription-out.log
    log_date_format: YYYY-MM-DD HH:mm:ss Z
    merge_logs: true
    max_memory_restart: 1G
    min_uptime: 10000
    max_restarts: 10
    autorestart: true
    watch: false
    restart_delay: 5000

  # Large Transcription Worker (low volume, >40 min meetings)
  - name: worker-transcription-large
    script: ./src/worker/index.js
    args: --type transcription-large --concurrency 2
    instances: 1
    exec_mode: fork
    env:
      NODE_ENV: production
      WORKER_CONCURRENCY: 1
    env_development:
      NODE_ENV: development
      WORKER_CONCURRENCY: 1
    error_file: ./logs/pm2/worker-large-error.log
    out_file: ./logs/pm2/worker-large-out.log
    log_date_format: YYYY-MM-DD HH:mm:ss Z
    merge_logs: true
    max_memory_restart: 2G
    min_uptime: 10000
    max_restarts: 10
    autorestart: true
    watch: false
    restart_delay: 5000
